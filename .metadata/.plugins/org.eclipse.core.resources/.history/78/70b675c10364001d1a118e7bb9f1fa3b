package master;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

import dbconn.DBConnect;
import member.MemberVO;
import sports.SportsVo;

public class MasterDao {
	private DBConnect dbconn;
	public MasterDao() {
		dbconn = DBConnect.getInstance();
	}
	
	//전체회원정보확인
	public ArrayList<MemberVO> selectAll(){
		ArrayList<MemberVO> list = new ArrayList();
		String sql = "select * from member order by num desc";
		Connection conn = dbconn.conn();
		try {
			PreparedStatement pstmt = conn.prepareStatement(sql);
			ResultSet rs = pstmt.executeQuery();
			while (rs.next()) {
				list.add(new MemberVO(rs.getString(1), rs.getString(2), rs.getString(3), rs.getString(4), rs.getString(5),false , false);
			}
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return list;
	}
	
	//회원정보 id로 검색
	public MemberVO selectMemid(String memId) {
		String sql = "select*from member where memId=?";
		Connection conn = dbconn.conn();
		try {
			PreparedStatement pstmt = conn.prepareStatement(sql);
			pstmt.setString(1, memId);
			ResultSet rs = pstmt.executeQuery();
			if(rs.next()) {
				return new MemberVO(rs.getString(1),rs.getString(2),rs.getString(3), rs.getString(4), rs.getString(5), false, false);
			}
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return null;
	}
	//회원정보 삭제delete - id로 
		public void deleteMemid(String memId) {
			String sql = "delete from member where memId=?";
			Connection conn = dbconn.conn();
			try {
				PreparedStatement pstmt = conn.prepareStatement(sql);
				pstmt.setString(1, memId);
				pstmt.executeUpdate();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}finally {
				try {
					conn.close();
				} catch (SQLException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}
		}
		
	//회원블랙리스트 확인
		public ArrayList<MemberVO> printBlacklist() {
			ArrayList<MemberVO> list = new ArrayList();
			String sql = "select memId, name from Member where blacklist='1'";
			Connection conn = dbconn.conn();
			try {
				PreparedStatement pstmt = conn.prepareStatement(sql);
				ResultSet rs = pstmt.executeQuery();
				while(rs.next()) {
					list.add(new MemberVO(rs.getString(1), rs.getString(2), null, null, null, false, false)
				}
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} return list;
		}
	//블랙리스트 회원 추가
		public void insert(String memId) {
			String sql = "update member set black='1' where memid=?";
			Connection conn = dbconn.conn();
			try {
				PreparedStatement pstmt = conn.prepareStatement(sql); 
				pstmt.setString(1, memId);
				pstmt.executeUpdate();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}finally {
				try {
					conn.close();
				} catch (SQLException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}
		}
	//id로 블랙리스트 삭제
		public void deleteBlack(String memId) {
			String sql = "delete from member where blacklist='1' and memid=?";
			Connection conn = dbconn.conn();
			try {
				PreparedStatement pstmt = conn.prepareStatement(sql); 
				pstmt.setString(1, memId);
				pstmt.executeUpdate();
						
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}finally {
				try {
					conn.close();
				} catch (SQLException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}
		}
	//경기추가
		public void insert(SportsVo vo) {
			//글번호 nextval자동할당, 날짜 sysdate
			String sql = "insert into Sports values(sports_seq.nextval,?,?,?,?,?)";	
			Connection conn = dbconn.conn();
			try {
				PreparedStatement pstmt = conn.prepareStatement(sql); 
				pstmt.setString(1, vo.getName());
				pstmt.setString(2, vo.getSpo_date());
				pstmt.setString(3, vo.getLocation());
				pstmt.setString(4, vo.getTeam());
				pstmt.setString(5, vo.getTxt());
				pstmt.executeUpdate();
						
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}finally {
				try {
					conn.close();
				} catch (SQLException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}		
		}
	//경기번호로 경기수정
		public void update (SportsVo vo) {
			String sql = "update Sports set name=?, spo_date=? location=? team=? txt=? where sport_seq=?";
			Connection conn = dbconn.conn();
			try {
				PreparedStatement pstmt = conn.prepareStatement(sql);
				pstmt.setString(1, vo.getname());
				pstmt.setDate(2, vo.getDate());
				pstmt.setString(3, vo.getLocation());
				pstmt.setString(4, vo.getTeam());
				pstmt.setString(5, vo.getTxt());
				pstmt.setString(6, vo.getSport_seq);
				pstmt.executeUpdate();
				
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} finally {
				try {
					conn.close();
				} catch (SQLException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}
		}
	// 글번호로 경기종목삭제
		public void deleteSports(int sport_seq) {
			String sql = "delete from Sports where sport_seq=?";
			Connection conn = dbconn.conn();
			try {
				PreparedStatement pstmt = conn.prepareStatement(sql);
				pstmt.setInt(1, sport_seq);
				pstmt.executeUpdate();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}finally {
				try {
					conn.close();
				} catch (SQLException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}
		}
	//id로 게시글검색
		public PostVo selectById(String memId) {
			String sql = "select*from post where memId=?";
			Connection conn = dbconn.conn();
			try {
				PreparedStatement pstmt = conn.prepareStatement(sql);
				pstmt.setString(1, memId);
				ResultSet rs = pstmt.executeQuery();
				if(rs.next()) {
					return new PostVo(rs.getInt(1),rs.getString(2),rs.getString(3), rs.getString(4), rs.getDate(5), rs.getDate(6), rs.getInt(7));
				}
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			return null;
		}
	//글번호로 게시글삭제
		public void deletePost(int post_seq) {
			String sql = "delete from post where post_seq=?";
			Connection conn = dbconn.conn();
			try {
				PreparedStatement pstmt = conn.prepareStatement(sql);
				pstmt.setInt(1, post_seq);
				pstmt.executeUpdate();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}finally {
				try {
					conn.close();
				} catch (SQLException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}
		}
	//경기별 결제/미결제회원 확인 => 미결제회원출력
		public ResverationVo payment() {
			String sql = "select memid from Reservation where payment";
			Connection conn = dbconn.conn();
			try {
				PreparedStatement pstmt = conn.prepareStatement(sql);
				pstmt.executeUpdate();
			} catch (SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}finally {
				try {
					conn.close();
				} catch (SQLException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}
			}
		}
	//미결제회원 메시지보내기 . 서비스-> 보내시겠습니까? y/no보냈습니다
		
}

